<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.19" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>数据库加密 | El-12stu's Blog</title><meta name="description" content=""><link rel="preload" href="/assets/style-4KIAzwkz.css" as="style"><link rel="stylesheet" href="/assets/style-4KIAzwkz.css"><link rel="modulepreload" href="/assets/app-2v4np_wx.js"><link rel="modulepreload" href="/assets/index.html-BntNMAve.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-b7883777><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c7fdcb83></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-c7fdcb83> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-b7883777 data-v-99a768bd><div class="vp-navbar" vp-navbar data-v-99a768bd data-v-fbf29993><div class="wrapper" data-v-fbf29993><div class="container" data-v-fbf29993><div class="title" data-v-fbf29993><div class="vp-navbar-title" data-v-fbf29993 data-v-8c652022><a class="vp-link no-icon link title" href="/" data-v-8c652022 data-v-cfe440fb><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/theme.png" alt data-v-dfc28f5d><!--]--><!--[--><img class="vp-image light logo" src="/theme.png" alt data-v-dfc28f5d><!--]--><!--]--><!--]--><span data-v-8c652022>El-12stu&#39;s Blog</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-fbf29993><div class="content-body" data-v-fbf29993><!--[--><!--]--><div class="vp-navbar-search search" data-v-fbf29993><div class="search-wrapper" data-v-e9696132><!----><div id="local-search" data-v-e9696132><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-e9696132><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-fbf29993 data-v-f6d30c2a><span id="main-nav-aria-label" class="visually-hidden" data-v-f6d30c2a>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-f6d30c2a data-v-8d805753 data-v-cfe440fb><!--[--><!----><span data-v-8d805753>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-f6d30c2a data-v-8d805753 data-v-cfe440fb><!--[--><!----><span data-v-8d805753>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-f6d30c2a data-v-8d805753 data-v-cfe440fb><!--[--><!----><span data-v-8d805753>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-f6d30c2a data-v-8d805753 data-v-cfe440fb><!--[--><!----><span data-v-8d805753>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-f6d30c2a data-v-74b2dfda><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-74b2dfda><span class="text" data-v-74b2dfda><!----><!----><span data-v-74b2dfda>笔记</span><span class="vpi-chevron-down text-icon" data-v-74b2dfda></span></span></button><div class="menu" data-v-74b2dfda><div class="vp-menu" data-v-74b2dfda data-v-e6c467a6><div class="items" data-v-e6c467a6><!--[--><!--[--><div class="vp-menu-link" data-v-e6c467a6 data-v-a572da8e><a class="vp-link no-icon link" href="/interview/" data-v-a572da8e data-v-cfe440fb><!--[--><!----> 面经<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-fbf29993 data-v-92e8396f><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-92e8396f data-v-3d263837 data-v-6dc0ede0><span class="check" data-v-6dc0ede0><span class="icon" data-v-6dc0ede0><!--[--><span class="vpi-sun sun" data-v-3d263837></span><span class="vpi-moon moon" data-v-3d263837></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-fbf29993 data-v-c5ef5028 data-v-2da40a70><!--[--><a class="vp-social-link no-icon" href="https://github.com/El-12stu" aria-label="github" target="_blank" rel="noopener" data-v-2da40a70 data-v-58539d25><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-fbf29993 data-v-83ab08fd data-v-74b2dfda><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-74b2dfda><span class="vpi-more-horizontal icon" data-v-74b2dfda></span></button><div class="menu" data-v-74b2dfda><div class="vp-menu" data-v-74b2dfda data-v-e6c467a6><!----><!--[--><!--[--><!----><div class="group" data-v-83ab08fd><div class="item appearance" data-v-83ab08fd><p class="label" data-v-83ab08fd>外观</p><div class="appearance-action" data-v-83ab08fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-83ab08fd data-v-3d263837 data-v-6dc0ede0><span class="check" data-v-6dc0ede0><span class="icon" data-v-6dc0ede0><!--[--><span class="vpi-sun sun" data-v-3d263837></span><span class="vpi-moon moon" data-v-3d263837></span><!--]--></span></span></button></div></div></div><div class="group" data-v-83ab08fd><div class="item social-links" data-v-83ab08fd><div class="vp-social-links social-links-list" data-v-83ab08fd data-v-2da40a70><!--[--><a class="vp-social-link no-icon" href="https://github.com/El-12stu" aria-label="github" target="_blank" rel="noopener" data-v-2da40a70 data-v-58539d25><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-fbf29993 data-v-733fc1f9><span class="container" data-v-733fc1f9><span class="top" data-v-733fc1f9></span><span class="middle" data-v-733fc1f9></span><span class="bottom" data-v-733fc1f9></span></span></button></div></div></div></div><div class="divider" data-v-fbf29993><div class="divider-line" data-v-fbf29993></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-b7883777 data-v-ce9844b0><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-ce9844b0><span class="vpi-align-left menu-icon" data-v-ce9844b0></span><span class="menu-text" data-v-ce9844b0>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-ce9844b0 data-v-ffcb59fe><button data-v-ffcb59fe>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-b7883777 data-v-d4f27e87><div class="vp-doc-container is-blog" data-v-d4f27e87 data-v-f23cd2a4><!--[--><!--]--><div class="container" data-v-f23cd2a4><!----><div class="content" data-v-f23cd2a4><div class="content-container" data-v-f23cd2a4><!--[--><!--]--><main class="main" data-v-f23cd2a4><nav class="vp-breadcrumb" data-v-f23cd2a4 data-v-2571502d><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-2571502d><!--[--><li property="itemListElement" typeof="ListItem" data-v-2571502d><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-2571502d data-v-cfe440fb><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-2571502d></span><meta property="name" content="首页" data-v-2571502d><meta property="position" content="1" data-v-2571502d></li><li property="itemListElement" typeof="ListItem" data-v-2571502d><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-2571502d data-v-cfe440fb><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-2571502d></span><meta property="name" content="博客" data-v-2571502d><meta property="position" content="2" data-v-2571502d></li><li property="itemListElement" typeof="ListItem" data-v-2571502d><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=62a004" property="item" typeof="WebPage" data-v-2571502d data-v-cfe440fb><!--[-->MySQL<!--]--><!----></a><span class="vpi-chevron-right" data-v-2571502d></span><meta property="name" content="MySQL" data-v-2571502d><meta property="position" content="3" data-v-2571502d></li><li property="itemListElement" typeof="ListItem" data-v-2571502d><a class="vp-link no-icon link breadcrumb current" href="/article/5815f6gy/" property="item" typeof="WebPage" data-v-2571502d data-v-cfe440fb><!--[-->数据库加密<!--]--><!----></a><!----><meta property="name" content="数据库加密" data-v-2571502d><meta property="position" content="4" data-v-2571502d></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-63c61a0d>数据库加密 <!----></h1><div class="vp-doc-meta" data-v-63c61a0d><p class="reading-time" data-v-63c61a0d><span class="vpi-books icon" data-v-63c61a0d></span><span data-v-63c61a0d>约 1433 字</span><span data-v-63c61a0d>大约 5 分钟</span></p><p data-v-63c61a0d><span class="vpi-tag icon" data-v-63c61a0d></span><!--[--><a class="vp-link no-icon link tag vp-tag-g1rq" href="/blog/tags/?tag=网络安全" data-v-63c61a0d data-v-cfe440fb><!--[-->网络安全<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-qsoy" href="/blog/tags/?tag=数据库" data-v-63c61a0d data-v-cfe440fb><!--[-->数据库<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-g1rq" href="/blog/tags/?tag=加密存储" data-v-63c61a0d data-v-cfe440fb><!--[-->加密存储<!--]--><!----></a><!--]--></p><p class="create-time" data-v-63c61a0d><span class="vpi-clock icon" data-v-63c61a0d></span><span data-v-63c61a0d>2025-02-12</span></p></div><!--]--><div class="_article_5815f6gy_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-f23cd2a4><div data-v-f23cd2a4><h2 id="数据库加密详细流程设计" tabindex="-1"><a class="header-anchor" href="#数据库加密详细流程设计"><span><strong>数据库加密详细流程设计</strong></span></a></h2><p>在企业级应用中，数据库加密可以防止<strong>数据泄露、未授权访问、内部人员滥用、黑客攻击</strong>等安全风险。完整的数据库加密方案通常包含<strong>存储加密、传输加密、访问控制</strong>三个部分。下面是详细流程设计。</p><h1 id="方案选择" tabindex="-1"><a class="header-anchor" href="#方案选择"><span><strong>方案选择</strong></span></a></h1><table><thead><tr><th>加密方式</th><th>作用</th><th>适用场景</th><th>优缺点</th></tr></thead><tbody><tr><td><strong>透明数据加密（TDE）</strong></td><td>磁盘级加密</td><td>防止数据库文件泄露</td><td>易部署，不影响查询，但无法防 SQL 注入</td></tr><tr><td><strong>列级加密（Column Encryption）</strong></td><td>仅加密特定字段</td><td>保护如身份证号、密码等敏感数据</td><td>需要应用解密，查询性能受影响</td></tr><tr><td><strong>应用层加密（Client-side Encryption）</strong></td><td>在应用层加密数据后再存储</td><td>最安全，防 SQL 注入</td><td>需要修改代码，索引可能受影响</td></tr><tr><td><strong>传输层加密（TLS/SSL）</strong></td><td>加密数据在网络中的传输</td><td>防止中间人攻击</td><td>需要数据库和客户端支持 SSL</td></tr><tr><td>备份加密</td><td>防止备份文件被窃取后直接读取。</td><td>防止备份文件泄漏</td><td>保护了备份文件</td></tr><tr><td>访问控制</td><td>最小化权限，防止DBA滥用权限。</td><td>防范数据库管理员</td><td>最小化权限，需要明确各个角色权限</td></tr></tbody></table><hr><h1 id="透明数据加密-tde" tabindex="-1"><a class="header-anchor" href="#透明数据加密-tde"><span><strong>透明数据加密（TDE）</strong></span></a></h1><p><strong>目标</strong>：加密磁盘上的数据库文件，防止数据被物理盗取。</p><h3 id="_1-启用-tde" tabindex="-1"><a class="header-anchor" href="#_1-启用-tde"><span><strong>① 启用 TDE</strong></span></a></h3><p>在 MySQL <strong>Enterprise Edition</strong> 中，启用 <strong>Keyring 插件</strong>：</p><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">early-plugin-load</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">keyring_file.so</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">keyring_file_data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/var/lib/mysql-keyring/keyring</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，重启 MySQL：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-创建加密表" tabindex="-1"><a class="header-anchor" href="#_2-创建加密表"><span><strong>② 创建加密表</strong></span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> users</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">INT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> AUTO_INCREMENT </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    name</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    id_card </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">50</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">),</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    password</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">255</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) ENGINE</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">InnoDB </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ENCRYPTED</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">YES</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>效果</strong>：数据库存储的是加密数据，但查询时仍然返回明文。</p></blockquote><h3 id="_3-验证加密" tabindex="-1"><a class="header-anchor" href="#_3-验证加密"><span><strong>③ 验证加密</strong></span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> TABLE_SCHEMA, TABLE_NAME, CREATE_OPTIONS </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> information_schema</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">tables</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> TABLE_NAME </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">users</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>CREATE_OPTIONS</code> 显示 <code>ENCRYPTED=&#39;YES&#39;</code>，说明表已加密。</p><h1 id="tde-详细工作原理" tabindex="-1"><a class="header-anchor" href="#tde-详细工作原理"><span><strong>TDE 详细工作原理</strong></span></a></h1><p>TDE 主要依赖 <strong>数据加密密钥（DEK）</strong> 和 <strong>密钥加密密钥（KEK）</strong> 两级密钥体系进行数据加密。</p><h2 id="双层密钥体系" tabindex="-1"><a class="header-anchor" href="#双层密钥体系"><span><strong>双层密钥体系</strong></span></a></h2><table><thead><tr><th>密钥类型</th><th>作用</th><th>存储位置</th></tr></thead><tbody><tr><td><strong>数据加密密钥（DEK）</strong></td><td><strong>加密表空间</strong>（.ibd 文件）</td><td>存储在数据库内部，受 KEK 加密保护</td></tr><tr><td><strong>密钥加密密钥（KEK）</strong></td><td><strong>加密 DEK</strong>，确保密钥安全</td><td>由 MySQL 服务器通过 <strong>Keyring 插件</strong> 管理</td></tr></tbody></table><hr><h2 id="数据加密流程" tabindex="-1"><a class="header-anchor" href="#数据加密流程"><span><strong>数据加密流程</strong></span></a></h2><ol><li>用户插入数据 <ul><li>执行 <code>INSERT</code> 语句，数据被存入数据库。</li></ul></li><li>存储时使用 DEK 加密 <ul><li>MySQL 生成一个随机的 <strong>DEK（数据加密密钥）</strong>，并使用 <strong>AES-256</strong> 对表空间（<code>.ibd</code>）加密。</li></ul></li><li>DEK 被 KEK 加密 <ul><li>为了安全性，DEK <strong>不会直接存储</strong>，而是由 <strong>KEK</strong> 进行加密后存储。</li></ul></li><li>KEK 存储在 Keyring <ul><li>KEK 由 <strong>Keyring 插件</strong> 进行管理，可以使用文件、HSM、云 KMS 等方式存储。</li></ul></li></ol><hr><h2 id="数据解密流程" tabindex="-1"><a class="header-anchor" href="#数据解密流程"><span><strong>数据解密流程</strong></span></a></h2><ol><li>用户查询数据 <ul><li>例如 <code>SELECT * FROM users;</code>，数据库需要从 <code>.ibd</code> 文件中读取数据。</li></ul></li><li>获取 KEK <ul><li>MySQL 通过 Keyring 插件获取 <strong>KEK</strong>，解密 <strong>DEK</strong>。</li></ul></li><li>使用 DEK 解密表空间 <ul><li>解密 <code>.ibd</code> 文件中的加密数据，并返回明文数据给用户。</li></ul></li></ol><hr><h1 id="列级加密" tabindex="-1"><a class="header-anchor" href="#列级加密"><span>** 列级加密**</span></a></h1><p><strong>目标</strong>：仅加密敏感字段，如身份证号、密码等，提高安全性。</p><h2 id="_1-使用-aes-加密" tabindex="-1"><a class="header-anchor" href="#_1-使用-aes-加密"><span><strong>① 使用 AES 加密</strong></span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">INSERT INTO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> users (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, id_card, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">password</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">VALUES</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">张三</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, AES_ENCRYPT(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">420123199901012345</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">encryption_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">), AES_ENCRYPT(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mypassword</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">encryption_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-解密数据" tabindex="-1"><a class="header-anchor" href="#_2-解密数据"><span><strong>② 解密数据</strong></span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, AES_DECRYPT(id_card, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">encryption_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id_card, AES_DECRYPT(</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">password</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">encryption_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> password</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> users;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p><strong>效果</strong>：数据库存储的是加密数据，查询时需要密钥解密。</p></blockquote><h2 id="_3-设置访问权限" tabindex="-1"><a class="header-anchor" href="#_3-设置访问权限"><span><strong>③ 设置访问权限</strong></span></a></h2><p>防止 DBA 直接访问 <code>encryption_key</code>：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">REVOKE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> SELECT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> ON</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> users </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dba_user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h1 id="应用层加密" tabindex="-1"><a class="header-anchor" href="#应用层加密"><span><strong>应用层加密</strong></span></a></h1><p><strong>目标</strong>：在<strong>进入数据库前</strong>加密，<strong>离开数据库后</strong>解密，防止 SQL 注入攻击。</p><h2 id="_1-java-应用层加密" tabindex="-1"><a class="header-anchor" href="#_1-java-应用层加密"><span><strong>① Java 应用层加密</strong></span></a></h2><p>使用 <strong>AES-256 加密</strong>：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">encrypt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String value</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> throws Exception </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Cipher</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> cipher</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Cipher</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getInstance</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">AES</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    SecretKeySpec</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> secretKey</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> new</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> SecretKeySpec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getBytes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">AES</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cipher</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">init</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Cipher</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">ENCRYPT_MODE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> secretKey</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    return</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Base64</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getEncoder</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">encodeToString</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">cipher</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">doFinal</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">value</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getBytes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()));</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-在-java-中存储加密数据" tabindex="-1"><a class="header-anchor" href="#_2-在-java-中存储加密数据"><span><strong>② 在 Java 中存储加密数据</strong></span></a></h2><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> encryptedIdCard</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> encrypt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">420123199901012345</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MySecretKey12345</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> sql</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INSERT INTO users (name, id_card, password) VALUES (?, ?, ?)</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PreparedStatement</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> stmt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> conn</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">prepareStatement</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">stmt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setString</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">张三</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">stmt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setString</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> encryptedIdCard</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">stmt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setString</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> encrypt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mypassword</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MySecretKey12345</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">));</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">stmt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">executeUpdate</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>效果</strong>：数据库存储的是加密数据，<strong>即使 SQL 注入成功，也无法获取明文数据</strong>。</p></blockquote><hr><h1 id="传输层加密-tls-ssl" tabindex="-1"><a class="header-anchor" href="#传输层加密-tls-ssl"><span><strong>传输层加密（TLS/SSL）</strong></span></a></h1><p><strong>目标</strong>：防止中间人攻击，在 <strong>客户端和数据库之间加密通信</strong>。</p><h2 id="_1-服务器端启用-ssl" tabindex="-1"><a class="header-anchor" href="#_1-服务器端启用-ssl"><span><strong>① 服务器端启用 SSL</strong></span></a></h2><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ssl-ca</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/etc/mysql/ca.pem</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ssl-cert</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/etc/mysql/server-cert.pem</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ssl-key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/etc/mysql/server-key.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-客户端连接" tabindex="-1"><a class="header-anchor" href="#_2-客户端连接"><span><strong>② 客户端连接</strong></span></a></h2><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --ssl-ca=/etc/mysql/ca.pem</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --ssl-mode=REQUIRED</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p><strong>效果</strong>：所有 SQL 传输都是加密的，防止流量被劫持。</p></blockquote><hr><h1 id="备份加密" tabindex="-1"><a class="header-anchor" href="#备份加密"><span><strong>备份加密</strong></span></a></h1><p><strong>目标</strong>：防止备份文件被窃取后直接读取。</p><h3 id="_1-使用-mysql-加密备份" tabindex="-1"><a class="header-anchor" href="#_1-使用-mysql-加密备份"><span><strong>① 使用 MySQL 加密备份</strong></span></a></h3><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysqldump</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --user=root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --password</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --all-databases</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> openssl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -aes-256-cbc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -salt</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -out</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> backup.sql.enc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>这样，即使攻击者获取 <code>backup.sql.enc</code>，<strong>没有密钥也无法解密</strong>。</p></blockquote><h3 id="_2-恢复数据" tabindex="-1"><a class="header-anchor" href="#_2-恢复数据"><span><strong>② 恢复数据</strong></span></a></h3><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">openssl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -aes-256-cbc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -in</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> backup.sql.enc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -out</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> backup.sql</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> backup.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h1 id="访问控制" tabindex="-1"><a class="header-anchor" href="#访问控制"><span><strong>访问控制</strong></span></a></h1><p><strong>目标</strong>：最小化权限，防止DBA滥用权限。</p><h3 id="_1-最小化数据库用户权限" tabindex="-1"><a class="header-anchor" href="#_1-最小化数据库用户权限"><span><strong>① 最小化数据库用户权限</strong></span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> USER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> &#39;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">app_user</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&#39;@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> IDENTIFIED </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">BY</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">secure_password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">GRANT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">INSERT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">UPDATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> ON</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> mydb</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">users</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TO</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">app_user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这样，<code>app_user</code> 不能 <code>DELETE</code> 数据，也不能访问 <code>encryption_key</code>。</p></blockquote><h3 id="_2-使用双因素认证-2fa" tabindex="-1"><a class="header-anchor" href="#_2-使用双因素认证-2fa"><span><strong>② 使用双因素认证（2FA）</strong></span></a></h3><ul><li>对 <strong>数据库管理系统（DBMS）</strong> 开启 <strong>双因素认证</strong>，如 <strong>Google Authenticator</strong>。</li><li><strong>禁止 root 远程登录</strong>：</li></ul><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">skip-networking</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h1 id="监控与日志" tabindex="-1"><a class="header-anchor" href="#监控与日志"><span><strong>监控与日志</strong></span></a></h1><h3 id="_1-启用-mysql-审计日志" tabindex="-1"><a class="header-anchor" href="#_1-启用-mysql-审计日志"><span><strong>① 启用 MySQL 审计日志</strong></span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> GLOBAL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> log_output </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FILE</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> GLOBAL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> general_log_file </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/var/log/mysql/mysql.log</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> GLOBAL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> general_log </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> ON</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-监控异常查询" tabindex="-1"><a class="header-anchor" href="#_2-监控异常查询"><span><strong>② 监控异常查询</strong></span></a></h3><p>使用 <strong>Fail2Ban</strong> 阻止暴力破解：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">fail2ban-client</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h1 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span><strong>总结</strong></span></a></h1><p>✅ <strong>存储加密（TDE / 列级加密 / 应用层加密）</strong> 保护静态数据</p><p>✅ <strong>传输加密（TLS/SSL）</strong> 防止中间人攻击</p><p>✅ <strong>访问控制</strong> 限制数据库用户权限</p><p>✅ <strong>备份加密</strong> 防止备份泄露</p><p>✅ <strong>日志与监控</strong> 发现异常查询</p></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-f23cd2a4 data-v-64650673><!--[--><!--]--><!----><!----><nav class="prev-next" data-v-64650673><div class="pager" data-v-64650673><!----></div><div class="pager" data-v-64650673><a class="vp-link no-icon link pager-link next" href="/article/xht68izq/" data-v-64650673 data-v-cfe440fb><!--[--><span class="desc" data-v-64650673>下一页</span><span class="title" data-v-64650673>Redisson-WatchDog机制</span><!--]--><!----></a></div></nav></footer><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;" data-v-f23cd2a4><div style="display: flex;
align-items: center;
justify-content: center;
height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);
--icon-size: 48px;
display: inline-block;
width: var(--icon-size);
height: var(--icon-size);
background-color: currentcolor;
-webkit-mask-image: var(--loading-icon);
mask-image: var(--loading-icon);
"></span></div></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-b7883777 data-v-43ba0179><span class="percent" data-allow-mismatch data-v-43ba0179>0%</span><span class="show icon vpi-back-to-top" data-v-43ba0179></span><svg aria-hidden="true" data-v-43ba0179><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-43ba0179></circle></svg></button><footer class="vp-footer" vp-footer data-v-b7883777 data-v-16eb55d1><!--[--><div class="container" data-v-16eb55d1><p class="message" data-v-16eb55d1>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-2v4np_wx.js" defer></script></body></html>